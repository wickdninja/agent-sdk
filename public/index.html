<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brew & Byte Café - AI-Powered Coffee Experience</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'coffee': {
                            50: '#fdf8f3',
                            100: '#f9ede0',
                            200: '#f2d9bf',
                            300: '#e9bc94',
                            400: '#de9968',
                            500: '#d47e4a',
                            600: '#c66640',
                            700: '#a44e36',
                            800: '#844032',
                            900: '#6b362b',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .chat-message {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        .animate-fade-in {
            animation: fadeIn 0.3s ease-out;
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }
        
        /* Custom scrollbar for suggestions */
        .scrollbar-thin {
            scrollbar-width: thin;
        }
        
        .scrollbar-thumb-coffee-300::-webkit-scrollbar-thumb {
            background-color: #e9bc94;
            border-radius: 4px;
        }
        
        .scrollbar-track-coffee-100::-webkit-scrollbar-track {
            background-color: #f9ede0;
            border-radius: 4px;
        }
        
        .scrollbar-thin::-webkit-scrollbar {
            height: 6px;
        }
        
        /* Suggestion card animation */
        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        .suggestion-card {
            animation: fadeInScale 0.3s ease-out;
        }
        
        /* Mute button active state */
        #mute-button.muted {
            background-color: #dc2626;
        }
        
        /* Speaking indicator */
        .speaking-indicator {
            display: inline-block;
            animation: pulse 1.5s infinite;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-coffee-100 to-coffee-50">
    <!-- Header -->
    <header class="bg-coffee-800 text-white shadow-lg">
        <div class="container mx-auto px-4 py-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <svg class="w-10 h-10 text-coffee-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17h6M9 17v1a1 1 0 01-1 1H6a1 1 0 01-1-1v-1M9 17V7a2 2 0 012-2h2a2 2 0 012 2v10M15 17v1a1 1 0 001 1h2a1 1 0 001-1v-1M15 17V7M5 7h14l-.75 2.5M9 7V5a2 2 0 012-2h2a2 2 0 012 2v2"></path>
                    </svg>
                    <div>
                        <h1 class="text-3xl font-bold">Brew & Byte Café</h1>
                        <p class="text-coffee-200 text-sm">Your AI-Powered Coffee Experience</p>
                    </div>
                </div>
                <div id="status-indicator" class="flex items-center px-3 py-1 rounded-full text-sm bg-gray-500">
                    <div id="status-dot" class="w-2 h-2 rounded-full mr-2 bg-gray-300"></div>
                    <span id="status-text">Disconnected</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container-fluid px-4 py-8">
        <div class="flex gap-4">
            <!-- Left Panel - Full Menu -->
            <div class="w-64 flex-shrink-0">
                <div class="bg-white rounded-xl shadow-lg p-4 sticky top-4">
                    <h2 class="text-lg font-bold text-coffee-800 mb-4">☕ Full Menu</h2>
                    
                    <!-- Dynamic Menu Content -->
                    <div id="menu-content">
                        <div class="text-center py-4">
                            <div class="text-gray-500 text-sm">Loading menu...</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Center Content -->
            <div class="flex-1 max-w-3xl">
            <!-- Audio Visualizers (Hidden by default) -->
            <div id="audio-visualizers" class="bg-white rounded-2xl shadow-xl p-4 mb-4" style="display: none;">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <h3 class="text-sm font-semibold text-gray-700 mb-2">Your Microphone</h3>
                        <canvas id="mic-visualizer" class="w-full h-20 bg-gray-100 rounded-lg"></canvas>
                    </div>
                    <div>
                        <h3 class="text-sm font-semibold text-coffee-700 mb-2">Bella's Voice</h3>
                        <canvas id="agent-visualizer" class="w-full h-20 bg-gray-100 rounded-lg"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Chat/Order Window -->
            <div class="bg-white rounded-2xl shadow-xl p-6 mb-6 h-96 overflow-y-auto" id="chat-window">
                <div id="chat-messages" class="space-y-4">
                    <div id="initial-prompt" class="text-center text-gray-600 mt-20">
                        <svg class="w-16 h-16 mx-auto mb-4 text-coffee-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                        </svg>
                        <p class="text-xl font-semibold text-coffee-800">Welcome to Brew & Byte Café!</p>
                        <p class="text-lg mt-2">Select an item from the menu</p>
                        <p class="text-sm text-gray-500">or</p>
                        <button id="quick-start-button" class="mt-3 bg-coffee-600 hover:bg-coffee-700 text-white px-6 py-3 rounded-full font-semibold transition-all transform hover:scale-105">
                            Start Order
                        </button>
                    </div>
                </div>
            </div>


            <!-- Control Panel (Hidden by default) -->
            <div id="control-panel" class="bg-white rounded-2xl shadow-xl p-6" style="display: none;">
                <!-- Session Controls -->
                <div class="flex items-center justify-center space-x-4">
                    <!-- Mute Button -->
                    <button 
                        id="mute-button"
                        class="flex items-center justify-center space-x-2 bg-blue-600 hover:bg-blue-700 text-white px-6 py-4 rounded-xl font-semibold transition-all"
                    >
                        <svg id="mute-icon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path>
                        </svg>
                        <svg id="unmute-icon" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" clip-rule="evenodd"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"></path>
                        </svg>
                        <span id="mute-text">Mute</span>
                    </button>
                    
                    <!-- Start Over Button -->
                    <button 
                        id="start-over-button"
                        class="flex items-center space-x-2 bg-yellow-600 hover:bg-yellow-700 text-white px-6 py-4 rounded-xl font-semibold transition-all"
                    >
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                        </svg>
                        <span>Start Over</span>
                    </button>
                </div>

                <!-- Instructions -->
                <div class="mt-4 text-center text-sm text-gray-600">
                    <p id="instructions">You're connected to Bella, our AI barista</p>
                    <p class="mt-1 text-xs text-gray-500">Speak naturally - she's listening and will respond</p>
                    <p class="mt-2 text-xs text-gray-400">💡 Tip: Use the Mute button to discuss with others privately</p>
                </div>
            </div>

            <!-- Current Order Status Modal -->
            <div id="order-status" class="hidden fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white rounded-xl shadow-2xl p-6 z-50 max-w-md w-full mx-4 animate-fade-in">
                <div class="flex items-center justify-center mb-4">
                    <div class="bg-green-100 rounded-full p-3">
                        <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                    </div>
                </div>
                <h3 class="font-bold text-xl text-center text-gray-800 mb-4">Order Confirmed!</h3>
                <div class="bg-gray-50 rounded-lg p-4 mb-4">
                    <div class="flex justify-between mb-2">
                        <span class="text-sm text-gray-600">Order Number:</span>
                        <span class="text-sm font-bold text-gray-800">#<span id="order-id"></span></span>
                    </div>
                    <div class="flex justify-between mb-2">
                        <span class="text-sm text-gray-600">Status:</span>
                        <span class="text-sm font-semibold text-green-600"><span id="order-status-text"></span></span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-sm text-gray-600">Ready in:</span>
                        <span class="text-sm font-semibold text-gray-800"><span id="order-time"></span></span>
                    </div>
                </div>
                <button id="order-ok-button" class="w-full bg-coffee-600 hover:bg-coffee-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors">
                    OK
                </button>
            </div>
            
            <!-- Overlay backdrop for order status -->
            <div id="order-overlay" class="hidden fixed inset-0 bg-black bg-opacity-50 z-40"></div>

            </div>
            
            <!-- Right Panel - Suggestions -->
            <div class="w-72 flex-shrink-0">
                <div id="suggestions-panel" class="bg-white rounded-xl shadow-lg p-4 sticky top-4" style="display: none;">
                    <h2 class="text-lg font-bold text-coffee-800 mb-4">💡 Suggestions</h2>
                    <div id="suggestions-container" class="space-y-3">
                        <!-- Suggestions will be dynamically added here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="agent.js"></script>
    <script>
        // Load menu dynamically from API
        async function loadMenu() {
            try {
                const response = await fetch('/api/tools/menu');
                const menuData = await response.json();
                renderMenu(menuData);
            } catch (error) {
                console.error('Failed to load menu:', error);
                document.getElementById('menu-content').innerHTML = '<div class="text-red-500 text-sm p-2">Failed to load menu</div>';
            }
        }
        
        function renderMenu(menuData) {
            const menuContent = document.getElementById('menu-content');
            let html = '';
            
            // Render drinks
            if (menuData.drinks) {
                // Espresso drinks
                if (menuData.drinks.espresso && menuData.drinks.espresso.length > 0) {
                    html += '<div class="mb-4">';
                    html += '<h3 class="font-semibold text-coffee-700 mb-2 text-sm">☕ Espresso Drinks</h3>';
                    html += '<div class="space-y-1">';
                    menuData.drinks.espresso.forEach(item => {
                        html += `<button onclick="window.app?.speakToAgent('I want a ${item.name}')" class="w-full text-left px-2 py-1 text-xs hover:bg-coffee-50 rounded transition-colors">`;
                        html += '<div class="flex justify-between">';
                        html += `<span>${item.name}</span>`;
                        html += `<span class="text-coffee-600">$${item.price.toFixed(2)}</span>`;
                        html += '</div>';
                        html += '</button>';
                    });
                    html += '</div>';
                    html += '</div>';
                }
                
                // Cold drinks
                if (menuData.drinks.cold && menuData.drinks.cold.length > 0) {
                    html += '<div class="mb-4">';
                    html += '<h3 class="font-semibold text-coffee-700 mb-2 text-sm">🧊 Cold Drinks</h3>';
                    html += '<div class="space-y-1">';
                    menuData.drinks.cold.forEach(item => {
                        html += `<button onclick="window.app?.speakToAgent('I want a ${item.name}')" class="w-full text-left px-2 py-1 text-xs hover:bg-coffee-50 rounded transition-colors">`;
                        html += '<div class="flex justify-between">';
                        html += `<span>${item.name}</span>`;
                        html += `<span class="text-coffee-600">$${item.price.toFixed(2)}</span>`;
                        html += '</div>';
                        html += '</button>';
                    });
                    html += '</div>';
                    html += '</div>';
                }
                
                // Non-coffee drinks
                if (menuData.drinks.non_coffee && menuData.drinks.non_coffee.length > 0) {
                    html += '<div class="mb-4">';
                    html += '<h3 class="font-semibold text-coffee-700 mb-2 text-sm">🍵 Other Drinks</h3>';
                    html += '<div class="space-y-1">';
                    menuData.drinks.non_coffee.forEach(item => {
                        html += `<button onclick="window.app?.speakToAgent('I want a ${item.name}')" class="w-full text-left px-2 py-1 text-xs hover:bg-coffee-50 rounded transition-colors">`;
                        html += '<div class="flex justify-between">';
                        html += `<span>${item.name}</span>`;
                        html += `<span class="text-coffee-600">$${item.price.toFixed(2)}</span>`;
                        html += '</div>';
                        html += '</button>';
                    });
                    html += '</div>';
                    html += '</div>';
                }
            }
            
            // Render food
            if (menuData.food) {
                // Pastries
                if (menuData.food.pastries && menuData.food.pastries.length > 0) {
                    html += '<div class="mb-4">';
                    html += '<h3 class="font-semibold text-coffee-700 mb-2 text-sm">🥐 Fresh Pastries</h3>';
                    html += '<div class="space-y-1">';
                    menuData.food.pastries.forEach(item => {
                        html += `<button onclick="window.app?.speakToAgent('I want a ${item.name}')" class="w-full text-left px-2 py-1 text-xs hover:bg-coffee-50 rounded transition-colors">`;
                        html += '<div class="flex justify-between">';
                        html += `<span>${item.name}</span>`;
                        html += `<span class="text-coffee-600">$${item.price.toFixed(2)}</span>`;
                        html += '</div>';
                        html += '</button>';
                    });
                    html += '</div>';
                    html += '</div>';
                }
            }
            
            // Render customizations
            if (menuData.customizations) {
                // Milk options
                if (menuData.customizations.milk && menuData.customizations.milk.length > 0) {
                    html += '<div class="mb-4">';
                    html += '<h3 class="font-semibold text-coffee-700 mb-2 text-sm">🥛 Milk Options</h3>';
                    html += '<div class="space-y-1 text-xs text-gray-600">';
                    menuData.customizations.milk.forEach(item => {
                        const priceText = item.price > 0 ? ` (+$${item.price.toFixed(2)})` : '';
                        html += `<div class="px-2">• ${item.name}${priceText}</div>`;
                    });
                    html += '</div>';
                    html += '</div>';
                }
            }
            
            menuContent.innerHTML = html;
        }
        
        // Load menu when page loads
        document.addEventListener('DOMContentLoaded', () => {
            loadMenu();
        });
    </script>
</body>
</html>